# üéÆ Dynamic Game & Venue Audience Segmentation

## ‚úÖ Implementation Complete - 2025-11-09 09:27 AM

### Overview
Implemented a fully dynamic audience segmentation system where **each game and each venue automatically becomes its own customer segment**. This allows for precise targeting and marketing campaigns based on specific games or venues.

---

## üéØ Key Features

### 1. Dynamic Game-Based Segments
Every game in your system automatically creates an audience segment:
- **Customer Count** - How many unique customers played this game
- **Total Bookings** - Total number of bookings for this game
- **Total Revenue** - Revenue generated by this game
- **Average Booking Value** - Average spend per booking
- **Last Booking Date** - Most recent booking for this game
- **Percentage** - What % of total customers played this game

### 2. Dynamic Venue-Based Segments
Every venue in your system automatically creates an audience segment:
- **Customer Count** - How many unique customers visited this venue
- **Total Bookings** - Total number of bookings at this venue
- **Total Revenue** - Revenue generated by this venue
- **Average Booking Value** - Average spend per booking
- **Last Booking Date** - Most recent booking at this venue
- **Percentage** - What % of total customers visited this venue

### 3. Audience Lists
For each game or venue, you can get a detailed list of customers:
- Customer name, email, phone
- Total bookings for that game/venue
- Total spent on that game/venue
- First and last booking dates
- Average booking value

---

## üìä Database Functions

### `get_game_segments(org_id)`
Returns all games as audience segments with metrics:
```sql
SELECT 
  game_id,
  game_name,
  game_image_url,
  customer_count,
  total_bookings,
  total_revenue,
  avg_booking_value,
  last_booking_date
FROM games
LEFT JOIN bookings...
GROUP BY game
ORDER BY customer_count DESC
```

### `get_game_audience(game_id)`
Returns customer list for a specific game:
```sql
SELECT 
  customer_id,
  customer_name,
  customer_email,
  customer_phone,
  total_bookings,
  total_spent,
  last_booking_date,
  first_booking_date,
  avg_booking_value
FROM customers
INNER JOIN bookings ON game_id = ?
GROUP BY customer
ORDER BY total_bookings DESC
```

### `get_venue_segments(org_id)`
Returns all venues as audience segments with metrics (same structure as games)

### `get_venue_audience(venue_id)`
Returns customer list for a specific venue (same structure as games)

---

## üîß Hook Functions

### useCustomers Hook - New Functions

```typescript
// Get all games as segments
const gameSegments = await getGameSegments(organizationId);
// Returns: GameSegment[]

// Get customers for a specific game
const gameAudience = await getGameAudience(gameId);
// Returns: GameAudienceMember[]

// Get all venues as segments
const venueSegments = await getVenueSegments(organizationId);
// Returns: VenueSegment[]

// Get customers for a specific venue
const venueAudience = await getVenueAudience(venueId);
// Returns: VenueAudienceMember[]
```

### TypeScript Interfaces

```typescript
interface GameSegment {
  game_id: string;
  game_name: string;
  game_image_url: string;
  customer_count: number;
  total_bookings: number;
  total_revenue: number;
  avg_booking_value: number;
  last_booking_date: string;
}

interface GameAudienceMember {
  customer_id: string;
  customer_name: string;
  customer_email: string;
  customer_phone: string;
  total_bookings: number;
  total_spent: number;
  last_booking_date: string;
  first_booking_date: string;
  avg_booking_value: number;
}

// Similar interfaces for VenueSegment and VenueAudienceMember
```

---

## üé® UI Implementation

### Tabbed Interface
The Segments page now has 3 tabs:

1. **Lifecycle & Spending** (8 segments)
   - New Customers
   - Active Customers
   - At-Risk Customers
   - Churned Customers
   - VIP Customers
   - High Spenders
   - Game Players (general)
   - Venue Visitors (general)

2. **Game Audiences** (Dynamic - one per game)
   - Each game shows as a segment card
   - Pink color theme
   - Gamepad icon
   - Shows customer count and revenue
   - Example: "Laser Tag" segment with 45 customers

3. **Venue Audiences** (Dynamic - one per venue)
   - Each venue shows as a segment card
   - Teal color theme
   - Building icon
   - Shows customer count and revenue
   - Example: "Downtown Arena" segment with 67 customers

### Segment Cards
Each segment card displays:
- **Icon** - Visual identifier (game/venue specific)
- **Name** - Game or venue name
- **Customer Count** - Large number showing audience size
- **Percentage Badge** - % of total customers
- **Progress Bar** - Visual representation of percentage
- **Description** - Bookings count and revenue

### Empty States
- Shows friendly message when no games/venues exist
- Explains that segments will appear once bookings are made
- Includes icon and helpful text

---

## üöÄ How It Works

### Automatic Population
1. Customer makes a booking for a game at a venue
2. System automatically updates:
   - Game segment (adds customer to that game's audience)
   - Venue segment (adds customer to that venue's audience)
3. Segments recalculate in real-time
4. UI updates automatically

### Dynamic Calculation
- No manual configuration needed
- Segments created automatically from booking data
- Counts and percentages calculated on-the-fly
- Updates whenever bookings change

### Real-Time Updates
- useEffect triggers when customer data changes
- Fetches latest game and venue segments
- Recalculates percentages
- Updates UI immediately

---

## üìà Marketing Use Cases

### Game-Based Targeting
1. **Game-Specific Promotions**
   - "20% off your next Laser Tag booking"
   - Target only customers who played Laser Tag

2. **New Game Launch**
   - Target customers who played similar games
   - "You loved Laser Tag, try our new VR Experience"

3. **Re-engagement**
   - Target customers who haven't played a specific game in 30 days
   - "We miss you at Laser Tag!"

4. **Cross-Selling**
   - Target customers who played Game A
   - Promote Game B that complements it

### Venue-Based Targeting
1. **Venue-Specific Offers**
   - "Free drink at Downtown Arena"
   - Target only Downtown Arena visitors

2. **New Venue Promotion**
   - Target customers from other venues
   - "Try our new Uptown location"

3. **Capacity Management**
   - Promote less-visited venues to regular customers
   - Balance traffic across locations

4. **Local Marketing**
   - Target customers by venue location
   - Geo-specific campaigns

### Combined Targeting
- Customers who played Game X at Venue Y
- High spenders at specific venues
- Frequent players of specific games
- VIP customers at premium venues

---

## üîç Example Scenarios

### Scenario 1: Laser Tag Promotion
```
Segment: "Laser Tag" Game Audience
- 45 customers
- 120 total bookings
- $3,600 revenue
- $30 avg booking value

Action: Send email to all 45 customers
Subject: "Exclusive Laser Tag Tournament - 30% Off"
```

### Scenario 2: New Venue Launch
```
Segment: "Downtown Arena" Venue Audience
- 67 customers (existing venue visitors)

Action: Invite them to new "Uptown Arena"
Subject: "You loved Downtown, try our new Uptown location!"
Offer: First booking free at Uptown Arena
```

### Scenario 3: Game Cross-Sell
```
Segment 1: "Escape Room" - 89 customers
Segment 2: "VR Experience" - 34 customers
Overlap: 12 customers played both

Action: Target the 77 Escape Room customers who haven't tried VR
Subject: "Escape Room fans love our VR Experience"
```

---

## üìÅ Files Modified

1. **src/supabase/migrations/012_add_game_based_segments.sql** (NEW)
   - 4 new RPC functions
   - Game and venue segment queries
   - Audience list queries

2. **src/hooks/useCustomers.ts**
   - Added 4 new interfaces
   - Added 4 new functions
   - Exported all functions

3. **src/components/customers/CustomerSegments.tsx**
   - Added tabbed interface
   - Added game segments display
   - Added venue segments display
   - Added empty states
   - Added dynamic badges

---

## ‚ú® Benefits

### For Marketing
- **Precise Targeting** - Target exact customer groups
- **Personalization** - Game/venue-specific messaging
- **Higher Conversion** - Relevant offers to interested customers
- **Easy Segmentation** - No manual list management

### For Analytics
- **Game Performance** - See which games attract most customers
- **Venue Performance** - See which venues are most popular
- **Revenue Analysis** - Revenue per game/venue
- **Customer Preferences** - Understand what customers like

### For Operations
- **Automatic** - No manual segment creation
- **Real-Time** - Always up-to-date
- **Scalable** - Works with any number of games/venues
- **Dynamic** - Adapts as you add/remove games/venues

---

## üß™ Testing

### Test Game Segments
1. Navigate to Customers page
2. Click "Segments and Marketing" tab
3. Click "Game Audiences" tab
4. Verify each game shows as a segment
5. Check customer counts are correct
6. Verify revenue calculations
7. Check percentages add up

### Test Venue Segments
1. Click "Venue Audiences" tab
2. Verify each venue shows as a segment
3. Check customer counts are correct
4. Verify revenue calculations
5. Check percentages add up

### Test Empty States
1. If no games/venues, verify empty state shows
2. Check helpful message displays
3. Verify icon appears

---

## üéä Summary

**What's New:**
- ‚úÖ Dynamic game-based audience segments
- ‚úÖ Dynamic venue-based audience segments
- ‚úÖ 4 new database functions
- ‚úÖ 4 new hook functions
- ‚úÖ Tabbed segment interface
- ‚úÖ Real-time segment calculation
- ‚úÖ Customer lists per game/venue
- ‚úÖ Revenue metrics per game/venue
- ‚úÖ Empty states for better UX

**Fully Dynamic:**
- ‚úÖ No manual configuration
- ‚úÖ Automatic segment creation
- ‚úÖ Real-time updates
- ‚úÖ Scales with your data

**Ready for:**
- ‚úÖ Game-specific marketing campaigns
- ‚úÖ Venue-specific promotions
- ‚úÖ Cross-selling opportunities
- ‚úÖ Performance analytics
- ‚úÖ Customer preference analysis

**Committed to GitHub:** ‚úÖ
**Commit:** 788a5fd
**Branch:** main
**Status:** Live and Ready to Use! üöÄ
